# –ï—Å—Ç—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–µ –ø–æ–ª–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –¥–µ—Ä–µ–≤—å—è –∏ —Ä–µ–∫–∏.
# –î–µ—Ä–µ–≤—å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –±—É–¥—É—Ç –≤—ã—Ä–∞—Å—Ç–∞—Ç—å –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞–≥–æ—Ä–∞—Ç—å—Å—è.
# –ó–∞–¥–∞—á–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã –≤–æ–≤—Ä–µ–º—è —Ç—É—à–∏—Ç—å —ç—Ç–∏ –¥–µ—Ä–µ–≤—å—è —Å –ø–æ–º–æ—â—å—é –≤–µ—Ä—Ç–æ–ª–µ—Ç–∞.
# –í–µ—Ä—Ç–æ–ª–µ—Ç –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –ø–æ –∫–∞—Ä—Ç–µ, –ø—Ä–æ–ª–µ—Ç–∞—è –Ω–∞–¥ –∫–ª–µ—Ç–∫–æ–π —Å –≤–æ–¥–æ–π –æ–Ω –±–µ—Ä–µ—Ç –µ–µ –≤ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä –∏ –º–æ–∂–µ—Ç –ø–æ—Ç—É—à–∏—Ç—å –æ–¥–Ω–æ –¥–µ—Ä–µ–≤–æ.
# –ï—Å–ª–∏ –¥–µ—Ä–µ–≤–æ –≤–æ–≤—Ä–µ–º—è –Ω–µ –ø–æ—Ç—É—à–∏—Ç—å –æ–Ω–æ —Å–≥–æ—Ä–∏—Ç, –∞ –ø–æ–∂–∞—Ä —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏—Ç—Å—è.
# –ï—Å–ª–∏ –¥–µ—Ä–µ–≤–æ —Å–≥–æ—Ä–µ–ª–æ - –º—ã —Ç–µ—Ä—è–µ–º –æ—á–∫–∏.
# –ï—Å–ª–∏ –ø–æ—Ç—É—à–∏–ª–∏ –¥–µ—Ä–µ–≤–æ - –ø–æ–ª—É—á–∞–µ–º –æ—á–∫–∏.
# –¢–∞–∫–∂–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è.
# –£ –≤–µ—Ä—Ç–æ–ª–µ—Ç–∞ –±—É–¥–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–µ–π.
# –ë—É–¥–µ—Ç –≥–æ—Å–ø–∏—Ç–∞–ª—å –≤ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∑–∞–ª–µ—Ç–µ—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –∑–∞ –æ—á–∫–∏.
# –¢–∞–∫–∂–µ –±—É–¥–µ—Ç –º–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π –≤ –∫–æ—Ç–æ—Ä–æ–º –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –¥–ª—è –≤–æ–¥—ã.

# üå≤üåäüöÅüü©üî•üè•üíõü™£üè™üèÜ‚¨õ
# üåÄ - –≥—Ä–æ–∑–æ–≤–æ–µ –æ–±–ª–∞–∫–æ —Å –º–æ–ª–Ω–∏–µ–π
# üí® - –æ–±—ã—á–Ω–æ–µ –æ–±–ª–∞–∫–æ
from pynput import keyboard
from map import Map
import time
import os
import json
from helicopter import Helicopter as Helico
from clouds import Clouds as Clouds

TICK_SLEEP = 0.05
TREE_UPDATE = 50
CLOUDS_UPDATE = 100
FIRE_UPDATE = 75
MAP_W, MAP_H = 20, 10

field = Map(MAP_W, MAP_H)
clouds = Clouds(MAP_W, MAP_H)
helico = Helico(MAP_W, MAP_H)
tick = 1

MOVES = {'w': (-1, 0), 'd': (0, 1), 's': (1, 0), 'a': (0, -1)}
# f - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, g - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
def process_key(key):
    global helico, tick, clouds, field
    c = key.char.lower()

    # –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏–π –≤–µ—Ä—Ç–æ–ª–µ—Ç–∞
    if c in MOVES.keys():
        dx, dy = MOVES[c][0], MOVES[c][1]
        helico.move(dx, dy)
    # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
    elif c == 'f':
        data = {"helicopter": helico.export_data(), 
                "clouds": clouds.export_data(), 
                "field": field.export_data(),
                "tick": tick}
        with open("level.json", "w") as lvl:
            json.dump(data, lvl)
    # –∑–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
    elif c == 'g':
        with open("level.json", "r") as lvl:
            data = json.load(lvl)
            tick = data["tick"] or 1
            helico.import_data(data["helicopter"])
            field.import_data(data["field"])
            clouds.import_data(data["clouds"])

listener = keyboard.Listener(
    on_press=None,
    on_release=process_key,)
listener.start()

while True:
    os.system("cls")
    field.process_helicopter(helico, clouds)
    helico.print_stats()
    field.print_map(helico, clouds)
    print("TICK", tick)
    tick += 1
    time.sleep(TICK_SLEEP)
    if (tick % TREE_UPDATE == 0):
        field.generate_tree()
    if (tick % FIRE_UPDATE == 0):
        field.update_fires()
    if (tick % CLOUDS_UPDATE == 0):
        clouds.update()
